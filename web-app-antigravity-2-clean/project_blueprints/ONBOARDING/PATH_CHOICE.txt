# PATH CHOICE - ONBOARDING STEP

**Created:** 2025-12-31  
**Phase:** MVP (Phase 1)  
**Priority:** Critical  
**Replaces:** Old 10-12 question questionnaire

---

## Overview

Path Choice is the NEW second step in onboarding (after ZIP code). Users choose between Professional (employee-focused) or Entrepreneur (business-focused), which determines their initial app experience, available tools, and AI coaching style.

This replaces the previous multi-question questionnaire with a single, clear decision point.

---

## User Journey

### Step-by-Step Flow

1. User completes Name step
2. User completes ZIP code step
3. **NEW: Path Choice page loads**
4. User sees two large, attractive cards:
   - Professional Path (ğŸ¢)
   - Entrepreneur Path (ğŸš€)
5. User clicks one card to select
6. **Tier rules notice** displays below cards (Starter: 1 switch, Plus/Pro: unlimited)
7. User confirms choice
8. Path saved to database (`profiles.user_path`, `profiles.primary_path`)
9. Redirect to Generating page (Life Plan â†’ Career Plan generation)
10. After generation â†’ Complete page

### Post-Onboarding Behavior

**First time visiting key features:**
- Jobs page â†’ Mini-questionnaire (employment status, goals)
- Courses page â†’ Mini-questionnaire (learning preferences)
- (Progressive profiling)

**Path switching (Settings):**
- Starter: Shows "1 switch remaining" or "Upgrade to switch again"
- Plus/Pro: Shows "Switch anytime" with simple confirmation

---

## Tier Access

**All tiers** can complete Path Choice during onboarding.

**Path switching rules:**
- **Starter:** Can switch once (total), then locked
- **Plus:** Unlimited switches
- **Pro:** Unlimited switches
- **ProTeams:** 
  - Owner + first 3 seats: Unlimited switches
  - Additional seats: Path locked at onboarding (permanent)

---

## Path-Specific Behavior

### Professional Path

**Initial setup:**
- `profiles.user_path = 'professional'`
- `profiles.primary_path = 'professional'`

**Career Plan generation:**
- AI focuses on employee career progression
- Milestones: Junior â†’ Senior â†’ Manager â†’ Director â†’ VP â†’ Executive
- Tools recommended: BMC, Resume Builder, Interview Prep

**BMB/BMC access:**
- Plus: BMC only (primary path)
- Pro: BMC + BMB (both paths)

### Entrepreneur Path

**Initial setup:**
- `profiles.user_path = 'entrepreneur'`
- `profiles.primary_path = 'entrepreneur'`

**Career Plan generation:**
- AI focuses on business milestones
- Milestones: Idea â†’ Validation â†’ MVP â†’ Launch â†’ Revenue â†’ Scaling
- Tools recommended: BMB, business courses

**BMB/BMC access:**
- Plus: BMB only (primary path)
- Pro: BMB + BMC (both paths)

---

## Mobile-First Requirements ğŸ“±

**CRITICAL: This feature must be designed mobile-first for Capacitor deployment.**

### Touch Optimization
- Card height: Minimum 200px (easy thumb reach)
- Buttons: Minimum 48px height (Apple/Android standard)
- Spacing between cards: 16px minimum
- Touch feedback: Active state with scale/color change

### Performance
- Load Path Choice page < 1 second on 4G
- Images optimized for mobile (if using icons/illustrations)
- No layout shift on load

### Capacitor Compatibility
- Uses client-side routing (Next.js App Router âœ…)
- No server-side API routes that won't work in static export
- Works offline (save choice locally, sync when online)

### Native Feel
- Status bar color matches app theme
- Safe area insets respected (iPhone notch, Android nav)
- Haptic feedback on card selection (optional enhancement)

---

## UI/UX Requirements

### Mobile-First Design

**Page Layout:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         [<  Back]    FE Logo    [Skip >]    â”‚  â† Header
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  Welcome to Felon Entrepreneur              â”‚
â”‚                                             â”‚
â”‚  Choose your path to get personalized       â”‚
â”‚  guidance and tools:                        â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ¢ Professional                     â”‚   â”‚
â”‚  â”‚                                     â”‚   â”‚
â”‚  â”‚ Level up and become the employee,  â”‚   â”‚
â”‚  â”‚ manager, supervisor, president or  â”‚   â”‚
â”‚  â”‚ CEO that is irreplaceable and the  â”‚   â”‚
â”‚  â”‚ company you work for can't live    â”‚   â”‚
â”‚  â”‚ without.                           â”‚   â”‚
â”‚  â”‚                                     â”‚   â”‚
â”‚  â”‚          [Choose Professional]      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸš€ Entrepreneur                     â”‚   â”‚
â”‚  â”‚                                     â”‚   â”‚
â”‚  â”‚ Launch into the life of passionate  â”‚   â”‚
â”‚  â”‚ business adventure that you can't   â”‚   â”‚
â”‚  â”‚ stop thinking about and build an    â”‚   â”‚
â”‚  â”‚ empire and a legacy.               â”‚   â”‚
â”‚  â”‚                                     â”‚   â”‚
â”‚  â”‚          [Choose Entrepreneur]      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                             â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”    â”‚
â”‚                                             â”‚
â”‚  IMPORTANT: PATH SWITCHING RULES            â”‚
â”‚                                             â”‚
â”‚  â€¢ Starter Plan: You can switch paths      â”‚
â”‚    ONCE. After that, upgrade to Plus.      â”‚
â”‚                                             â”‚
â”‚  â€¢ Plus/Pro: Unlimited path switching.     â”‚
â”‚    Full access to both paths.              â”‚
â”‚                                             â”‚
â”‚  Choose carefully, but don't worry â€”        â”‚
â”‚  you can always upgrade!                    â”‚
â”‚                                             â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”    â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Card Interaction:**
- Cards are large, tappable targets (min 200px height)
- Hover/focus state: subtle glow, slight scale up
- Active state: highlighted border
- Button inside card (not the whole card clickable to avoid accidental taps)

**Responsive:**
- Mobile (< 768px): Cards stack vertically
- Desktop (â‰¥ 768px): Cards side-by-side

---

## Database Schema

### Tables Updated

**profiles table:**
```sql
ALTER TABLE profiles ADD COLUMN user_path text CHECK (user_path IN ('professional', 'entrepreneur'));
ALTER TABLE profiles ADD COLUMN primary_path text CHECK (primary_path IN ('professional', 'entrepreneur'));
ALTER TABLE profiles ADD COLUMN path_switch_count integer DEFAULT 0;
```

**Track path switches:**
```sql
CREATE TABLE user_path_switches (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  from_path text NOT NULL CHECK (from_path IN ('professional', 'entrepreneur')),
  to_path text NOT NULL CHECK (to_path IN ('professional', 'entrepreneur')),
  tier_at_time text NOT NULL,
  switched_at timestamptz DEFAULT now()
);

ALTER TABLE user_path_switches ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users access own path switches" ON user_path_switches
  FOR ALL USING (auth.uid() = user_id);
```

---

## API Endpoints

### Save Path Choice

**Endpoint:** `POST /api/onboarding/save-path`

**Request:**
```json
{
  "path": "professional" | "entrepreneur"
}
```

**Logic:**
1. Authenticate user
2. Check if user already has path set (if yes, this is a switch, not initial choice)
3. If initial choice:
   - Set `profiles.user_path = path`
   - Set `profiles.primary_path = path`
4. If switch (from Settings):
   - Check tier
   - If Starter: Check `path_switch_count` (if â‰¥ 1, return 403 with upgrade prompt)
   - If Plus/Pro: Allow
   - Update `profiles.user_path = new_path`
   - Increment `path_switch_count`
   - Log to `user_path_switches`
5. Update `profiles.onboarding_step = 3` (move to Generating step)
6. Return success

**Response:**
```json
{
  "success": true,
  "path": "professional",
  "next_step": "/onboarding/generating"
}
```

---

## Business Rules

### Tier Enforcement

**Starter:**
- Initial choice: Free
- First switch: Free
- Second switch attempt: Blocked, show upgrade prompt

**Plus/Pro:**
- Unlimited switches
- Rate limit: Max 5 switches per 24 hours (anti-abuse)

**ProTeams Additional Seats (4+):**
- Path chosen at onboarding
- Locked permanently (no switches, no matter what tier owner has)

### Onboarding Step Tracking

**Updated step numbers:**
- Step 0: Name
- Step 1: ZIP code
- **Step 2: Path Choice** â† NEW
- Step 3: Generating (Career Plan)
- Step 4: Complete

### Path Switch Triggers Re-Onboarding

When user switches paths:
1. Path updated in database
2. Redirect to mini-onboarding specific to new path
3. Mini-onboarding collects 3-5 questions for that path
4. Career Plan regenerated with new path
5. User returned to dashboard with new path active

---

## Security Considerations

**RLS:**
- `profiles` table already has RLS (user can only read/update own row)
- `user_path_switches` has RLS policy

**Input Validation:**
- Path must be exactly 'professional' or 'entrepreneur' (enum check)
- User must be authenticated
- If switching, must respect tier limits

**Anti-Abuse:**
- Rate limit: 5 switches per 24 hours (even for Plus/Pro)
- Log all switches to `user_path_switches` for monitoring
- If suspicious pattern detected (e.g., 100 switches in a week), flag for review

---

## Implementation Notes

### File Structure

**Create new:**
- `app/(tunnel)/onboarding/path-choice/page.tsx`
- `app/(tunnel)/onboarding/path-choice/path-choice-cards.tsx` (component)
- `app/api/onboarding/save-path/route.ts`

**Delete:**
- `app/(tunnel)/onboarding/questions/` (entire folder, old questionnaire)

**Update:**
- `lib/profiles.ts` â†’ Update step mapping (step 2 = path-choice)
- `app/(tunnel)/onboarding/layout.tsx` â†’ Update progress bar (4 steps total)

### Component Hierarchy

```
page.tsx
â””â”€â”€ PathChoiceCards
    â”œâ”€â”€ ProfessionalCard
    â”‚   â””â”€â”€ ChooseButton
    â””â”€â”€ EntrepreneurCard
        â””â”€â”€ ChooseButton
```

### State Management

**No complex state needed:**
- User clicks button â†’ immediate API call
- Show loading state during save
- On success â†’ redirect to generating

---

## Verification Criteria

### Acceptance Tests

1. **New user onboarding:**
   - âœ… After ZIP code, sees Path Choice page
   - âœ… Can select Professional or Entrepreneur
   - âœ… Path saved to database correctly
   - âœ… Redirected to Generating page
   - âœ… Career Plan generated with correct path focus

2. **Path switching (Starter):**
   - âœ… Can switch once from Settings
   - âœ… Second switch blocked with upgrade prompt
   - âœ… Path switch count incremented correctly

3. **Path switching (Plus/Pro):**
   - âœ… Can switch unlimited times
   - âœ… Each switch triggers mini-onboarding
   - âœ… Career Plan regenerated correctly

4. **Mobile responsive:**
   - âœ… Cards stack vertically on mobile
   - âœ… Cards side-by-side on desktop
   - âœ… Touch targets large enough (min 44px)

5. **Security:**
   - âœ… Cannot set invalid path value
   - âœ… Cannot switch beyond tier limit
   - âœ… RLS prevents viewing other users' data

---

## Dependencies

**Blocks:**
- Career Plan generation (needs path to determine prompt)
- BMB/BMC access checks (need primary_path)
- AI Coach (needs path for context)

**Depends on:**
- Auth system âœ… (working)
- Profiles table âœ… (exists, needs column added)
- Onboarding routing âœ… (working, needs step update)

---

## Migration Path

**For existing users (if any):**
```sql
-- Infer path from old questionnaire answer (Q2: desired_employment)
UPDATE profiles
SET 
  user_path = CASE
    WHEN desired_employment LIKE '%business%' OR desired_employment LIKE '%entrepreneur%' THEN 'entrepreneur'
    ELSE 'professional'
  END,
  primary_path = user_path
WHERE user_path IS NULL;
```

**For new users:**
- Path Choice is mandatory (cannot skip)
- No default assigned (must choose)

---

## Future Enhancements

### Phase 2
- Path recommendation quiz (5 questions to suggest best path)
- "Not sure?" option â†’ takes quiz â†’ gets recommendation
- Path preview (try Professional for 7 days, then switch if wrong)

### Phase 3
- Hybrid path (access both equally from start, Pro-only)
- Path personality assessment (deeper than just Professional/Entrepreneur)

---

**Status:** Ready for implementation
**Estimated Effort:** 6-8 hours
**Files to create:** 3
**Files to update:** 2
**Files to delete:** 1 folder (~5 files)
