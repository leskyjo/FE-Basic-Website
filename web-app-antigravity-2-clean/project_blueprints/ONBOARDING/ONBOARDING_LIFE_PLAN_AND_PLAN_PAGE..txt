ONBOARDING_LIFE_PLAN_AND_PLAN_PAGE.md



Felon Entrepreneur — Life Plan Generation, Dashboard Globe, and Plan Page

This blueprint defines everything related to:

Generating the Life Goal Plan from questionnaire answers.

How the dashboard behaves immediately after onboarding (pulsing globe, status states).

The structure, layout, and behavior of the /plan page on mobile and desktop.

Back-end API design, database tables, and security.

Email behavior that is directly tied to the Life Plan being generated and becoming ready.

It must be consistent with:

ONBOARDING_OVERVIEW.md

ONBOARDING_AUTH_PROFILE.md

ONBOARDING_STEPS.md

ONBOARDING_NAV_LAYOUT.md

This file should give an AI builder enough detail to implement the Life Plan engine and UI end-to-end.

1. Core concept: Life Goal Plan

The Life Goal Plan is:

A structured, AI-generated plan created from:

The user’s questionnaire answers.

Basic profile data (name, ZIP, etc.).

One of the core promises of Felon Entrepreneur:

“Answer questions once, get a personal plan that shows what to do now, next, and later.”

Key principles:

Clarity over complexity — plan must read like a practical roadmap, not a technical report.

Actionable — always point to concrete steps, not just vague encouragement.

Versioned — each generation is a “plan version” we can track.

Secure and private — only the owner can see it.

2. When and how the Life Plan is generated
2.1 Generation trigger (from onboarding)

The initial plan generation is triggered:

When the user hits “Generate My Life Plan” on the last /onboarding/questions step.

At that moment:

Front-end:

Performs final validation of required questions.

Updates profiles.onboarding_step to 4 (if lower).

Calls the Life Plan generation API endpoint.

Immediately redirects the user to /dashboard.

Back-end (API endpoint):

Authenticates user.

Pulls in:

profiles row.

All questionnaire_answers for that user_id.

Creates or updates rows in:

ai_generations (log of generation job).

life_plans (plan content; may be created once AI returns).

2.2 API endpoint shape (conceptual)

Name (example):
POST /api/life-plan/generate

Responsibilities:

Validate that request is from an authenticated user.

Confirm that onboarding_step >= 3 (questions completed) before generating.

Ensure that generation is not spammed (rate limiting).

Start the generation process:

Synchronous (small volume) or

Asynchronous queue (recommended for production).

Inputs:

Ideally no client-controlled input beyond the auth session.

The server derives everything it needs from the database to avoid tampering.

Outputs:

Minimal JSON response, for example:

{ status: 'queued', generation_id: '...' } or { status: 'started' }.

Front-end does not wait for a full plan response; it simply redirects to /dashboard.

3. Data model: life_plans and ai_generations
3.1 life_plans table

Purpose: store the structured plan content.

Minimum columns:

id (UUID, primary key).

user_id (UUID, FK to auth user).

version (integer; 1 for first plan, 2, 3, etc., for regenerations).

plan_status (enum/text):

draft | active | archived

plan_data (JSONB): structured content used to render /plan.

summary (text): high-level summary of the plan (for dashboard snippets and emails).

created_at (timestamp).

updated_at (timestamp).

generated_by (text: e.g., initial_onboarding, manual_regeneration).

Optional:

source_generation_id (FK to ai_generations.id).

plan_title (text, e.g., “Your Life Goal Plan — Version 1”).

Key rules:

At any given time, one plan is “active” for a user:

“Active” plan is what /plan shows by default.

Prior plans can be “archived” but still stored.

3.2 ai_generations table

Purpose: log each AI generation attempt (success or failure).

Minimum columns:

id (UUID, primary key).

user_id.

generation_type (text): e.g., life_plan.

status (text): queued, running, succeeded, failed.

prompt_context_hash (text or checksum to detect duplicates).

input_snapshot (JSONB):

Minimal snapshot of questionnaire answers and profile used for this run (sanitized).

output_snapshot (JSONB or text):

Short summary from the AI response (not the full plan).

error_message (text, nullable).

token_count_prompt (int, nullable).

token_count_completion (int, nullable).

cost_estimate (numeric, nullable).

created_at, updated_at.

This table:

Helps debug generation issues.

Helps track costs and frequency.

Provides an audit log for any future analytics.

3.3 RLS (Row-Level Security) for these tables

For life_plans and ai_generations:

Normal user sessions may:

SELECT only rows where user_id = auth.uid().

Not INSERT directly from client (except possibly limited front-end operations via RPC; recommended to insert from server).

UPDATE only allowed via server-side logic (to avoid tampering).

Policy concept:

“user can see their own generations and plans; cannot create or modify them directly.”

Any admin/service operations are done with a service key and never from the browser.

4. AI prompt and response shape (high-level)

This blueprint does not dictate exact prompt wording, but it defines the shape of data the AI must receive and produce.

4.1 Input context to AI (from server)

The server builds a prompt context from:

profiles:

preferred_name

zip_code (and derived city/state if used)

All questionnaire_answers, structured as:

groups → questions → answers.

The server must:

Strip out unnecessary personally identifiable information (PII) like email.

Map raw answers into a schema that’s easy for the AI to understand, e.g.:

{
  "user_profile": {
    "preferred_name": "Tee",
    "location": {
      "zip_code": "12345",
      "city": "Example City",
      "state": "FL"
    }
  },
  "answers": [
    {
      "group_id": "background",
      "questions": [
        { "question_id": "bg_1", "answer": "..." },
        { "question_id": "bg_2", "answer": ["option_a", "option_c"] }
      ]
    }
  ]
}

4.2 Output shape (plan_data JSON)

The AI should return JSON that fits a consistent schema, for example:

{
  "plan_title": "Your 12-Month Life Goal Plan",
  "overview": {
    "summary": "Short plain-language summary of where they are and where they're heading.",
    "tone": "supportive, direct, honest"
  },
  "timeframes": {
    "next_7_days": [
      { "id": "t1", "title": "Task 1", "description": "..." }
    ],
    "next_30_days": [
      { "id": "t2", "title": "Task 2", "description": "..." }
    ],
    "next_90_days": [
      { "id": "t3", "title": "Task 3", "description": "..." }
    ],
    "next_12_months": [
      { "id": "t4", "title": "Task 4", "description": "..." }
    ]
  },
  "domains": {
    "jobs_and_career": {
      "summary": "Where they are and what to focus on.",
      "steps": [
        { "id": "jc1", "title": "Step 1", "description": "..." }
      ]
    },
    "money_and_debt": {
      "summary": "Money snapshot and plan.",
      "steps": []
    },
    "legal_and_supervision": {
      "summary": "...",
      "steps": []
    },
    "habits_and_health": {
      "summary": "...",
      "steps": []
    },
    "support_and_environment": {
      "summary": "...",
      "steps": []
    }
  },
  "risk_flags": [
    "possible housing instability",
    "needs basic documents (ID, SSN, etc.)"
  ],
  "encouragement": {
    "short_message": "Direct but positive 2–3 sentence message."
  }
}


This schema:

Supports a clean UI on the Plan page.

Allows future features (checklists, progress tracking).

The AI builder should be instructed (later) to enforce this schema strictly to avoid front-end breakage.

5. Dashboard behavior after generation trigger
5.1 States of the dashboard Life Plan card

The dashboard’s top section must display a Life Plan status card.

Possible states:

Generating (after first trigger, and while AI job is running).

Ready (plan exists and is active).

Error / Retry (generation failed).

No plan yet (shouldn’t happen after onboarding, but can exist in edge cases).

5.2 “Generating” state – pulsing globe

When:

onboarding_step >= 4 AND

No active life_plans row exists OR latest ai_generations.status is queued/running.

Visuals:

Large card at top of dashboard, full width (mobile) or left 2/3 (desktop).

Pulsing red globe animation:

Dark background.

Red pulsing effect migrating around a globe icon.

Text:

“We’re wiring your Life Goal Plan.”

Short explanation: “This usually takes about a minute. You can look around while we build it.”

Buttons:

Primary: “Refresh Plan Status”

Re-checks plan state via a client API call.

Secondary: optional “Learn how your plan works” that points to a read-only explainer.

5.3 “Ready” state – plan ready

When:

An active life_plans row exists for that user.

Card content:

Title: “Your Life Goal Plan is ready.”

Short summary from life_plans.summary.

Small bullet list of “Top 3 Focus Areas.”

Primary button: “View Life Plan” → /plan.

Secondary link: “Review your questions again” (behavior and re-gen rules defined later, likely tier-dependent).

5.4 “Error / Retry” state

If:

The last ai_generations row for this user has status = 'failed'.

Card:

Title: “We had trouble building your plan.”

Message: “Something went wrong on our side. You can retry or contact support if this keeps happening.”

Buttons:

Primary: “Try Again” — triggers POST /api/life-plan/generate again.

Secondary: “Contact Support” — links to /help or opens email.

Tier rules:

Retrying should be controlled by tier/fair-use logic (in Tiers blueprint), but at minimum allow 1–2 retries for free.

5.5 “No plan yet” state

Edge case (for example, if a bug prevented generation after onboarding).

Behavior:

Treat as if the user never generated.

Show the “No plan yet” card with a button “Generate My Life Plan now” that:

Calls the same generation endpoint.

Sets onboarding_step to 4 if needed.

Updates the UI to “Generating”.

6. /plan Page — Layout and UX
6.1 Route and access rules

Route: /plan

Access:

Logged-out: redirected to login or shown a marketing preview (depending on nav blueprint; for now, assume login redirect for direct access).

Logged-in with onboarding_step < 4: redirect to resume onboarding, not allowed.

Logged-in with onboarding_step >= 4:

If an active plan exists → show the complete Plan page.

If no active plan exists → show “No plan” or “Generating/error” state as in dashboard.

6.2 Mobile layout

Top of page:

Title: “Your Life Goal Plan”.

Subtitle: “Built from your answers. This is your roadmap — not a judgment.”

Status banner:

Small strip indicating:

“Version 1 · Generated on [date]”

If applicable: trial/tier info (e.g., “You can regenerate 1 more time on Starter.”)

Content sections (stacked vertically):

Overview

A card showing:

Short summary paragraph.

Encouragement message.

Optionally an avatar or simple icon.

Timeframes

Accordion or collapsible grouped segments:

“Next 7 days”

“Next 30 days”

“Next 90 days”

“Next 12 months”

Each timeframe shows a numbered list of tasks:

Title + short description.

Simple icons (checkbox, star, etc.).

Domains

Each domain as a collapsible card:

Jobs & Career

Money & Debt

Legal & Supervision

Habits & Health

Support & Environment

Opening a domain shows:

A short summary at top.

A list of concrete steps.

Risk Flags / Watch Items

Small “Heads up” card:

Bullet list of concerns the plan noticed.

Neutral, non-shaming language.

Encouragement / Mindset

Small card with 2–3 sentence message.

Bottom of page:

Buttons:

Primary: “Back to Dashboard” → /dashboard.

Secondary: “Download / Print Plan” (future), “Share to email” (future).

“Regenerate Plan” or “Update Plan” (visibility and behavior defined in tiers blueprint).

6.3 Desktop layout

Desktop should use 2-column layout where possible:

Left column (about 2/3 width):

Overview.

Timeframes.

Domains.

Right column (about 1/3 width):

Status summary card (version, date, tier).

Risk flags.

Encouragement / quick notes.

Later: shortcuts to Jobs, Courses that tie into the plan.

Cards:

Dark theme.

Soft shadows.

FE-red accents on section headers and key items.

6.4 Interactivity (future-friendly, but simple at launch)

At launch (Phase 1):

Plan is read-only: no editing of text or statuses inside the plan.

At most, we support:

Collapsing/expanding sections.

Basic in-page navigation (like “jump to Jobs & Career section”).

Later (but not required now):

Checkboxes for tasks.

Progress tracking.

Comments or notes.

The blueprint should make clear that:

For Phase 1, the Plan page is a view-only structured document generated from AI, not a full task manager.

7. Regeneration and versions (high-level behavior)

Details of regeneration + tiers will be in ONBOARDING_TIERS_AND_ACCESS.md, but we must define hooks here.

7.1 Basic versioning behavior

First plan: version = 1, plan_status = 'active'.

When regenerating:

Create a new row with version = previous_version + 1.

Set previous rows to plan_status = 'archived'.

Only the most recent active plan is shown on /plan by default.

7.2 Regeneration triggers

For now, consider two possible triggers:

From /plan page:

“Regenerate Plan” button:

Possibly shows warnings about usage/tier limits.

Calls the same /api/life-plan/generate with a generation_type of life_plan_regeneration.

From a “Review questions” flow:

User updates answers.

Then triggers a new plan.

Exact rules (how often, which tiers) will be specified in the Tiers blueprint.

7.3 Displaying older versions

Optional behavior (Phase 1 can stub this out):

A small “Plan history” link on /plan could show:

A list of versions with timestamps and short summary.

Clicking an old version sets it as “preview only” (does not change active plan).

The DB structure already supports a version and plan_status.

8. Security & abuse prevention around Life Plan generation
8.1 Rate limiting

We must protect against:

A user hammering the generation endpoint to drive up costs or attempt prompt injection.

Mechanisms:

Track generation attempts per user in ai_generations.

Apply rules like:

Only 1 active “queued/running” life_plan generation at a time per user.

Hard limit per day or month, depending on tier.

If limit exceeded:

Return error with friendly message and refer them to /help or an upgrade flow (if appropriate).

8.2 Input sanitization

The input to AI model is built server-side:

Never trust raw client JSON as AI input.

Always fetch inputs from:

profiles

questionnaire_answers

Server must:

Strip or encode any unexpected characters that might cause injection or break formatting.

Enforce maximum lengths for text answers (already handled at the question level).

8.3 Output validation

Once the AI returns a result:

Validate that it matches the expected JSON schema:

Required top-level keys: plan_title, overview, timeframes, domains, etc.

Fallback if missing keys:

Mark generation as failed in ai_generations.

Do not overwrite existing active plan.

Show error state on dashboard and allow retry.

This protects against malformed outputs breaking the UI.

9. Email behavior tied to Life Plan completion

This blueprint only covers the Life Plan–specific emails.

9.1 “Your Life Plan is ready” email

Trigger:

AI generation finishes successfully and a life_plans row is created with plan_status = 'active'.

Email content (high-level):

Subject: “Your Life Goal Plan is ready.”

Greeting using preferred_name.

Short summary of what the plan covers (use summary from life_plans if appropriate).

Button: “Open My Plan” linking to /plan.

Behavior:

Link should take them through normal auth:

If not logged in, they log in and then redirect to /plan.

If logged in, directly show /plan.

Logging:

Create an entry in email_events:

event_type = 'life_plan_ready'

user_id

Timestamp.

9.2 Optional “Plan update” emails (future)

When plan is regenerated or significantly updated (not required at launch):

Could send a brief “Your plan has been updated” email.

This is out-of-scope for Phase 1, but the data model allows it.

10. Implementation checklist for Codex / Builder

To build this correctly:

Implement server-side Life Plan generation endpoint:

POST /api/life-plan/generate or equivalent.

Auth check and onboarding_step check.

Fetch profiles and questionnaire_answers.

Insert ai_generations log with status = 'queued' or running.

Call AI model to generate JSON plan.

On success:

Insert row into life_plans with plan_data and summary.

Mark ai_generations.status = 'succeeded'.

On failure:

Mark ai_generations.status = 'failed' and store error_message.

Define life_plans and ai_generations schemas:

With fields listed above and secure RLS.

Wire up onboarding “Generate My Life Plan” button:

Final questionnaire step calls generation endpoint.

Sets onboarding_step = 4.

Redirects to /dashboard immediately.

Implement dashboard Life Plan card:

Detect states: generating, ready, error, no plan.

Show pulsing globe while generating.

Show summary card with “View Life Plan” when ready.

Show retry UI if error.

Implement /plan page:

Load active life_plans row for current user.

Render Overview, Timeframes, Domains, Risk flags, Encouragement as described.

Mobile: stacked layout.

Desktop: two-column layout with side summary.

Ensure routing and gating:

/plan only accessible when onboarding_step >= 4.

Logged-out users hitting /plan directly are prompted to login or shown a safe preview (depending on global routing decisions).

Implement rate limiting:

Prevent multiple overlapping life_plan generations for a single user.

Enforce daily/monthly limits (wired later into tiers blueprint but structure should be in place).

Tie in “Life Plan ready” email:

After successful plan creation, send email and log event.