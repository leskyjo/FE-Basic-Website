WEB_BLUEPRINT — PLAN TAB / LIFE PLAN

(FELON ENTREPRENEUR WEB APP, MOBILE-FIRST)

This blueprint is structured so we can derive high-quality prompts for:

Frontend (Next.js App Router + React + TypeScript + Tailwind CSS)

Backend (Next.js Route Handlers (server endpoints) + Supabase client)

Database schema in Supabase (Postgres + RLS (row-level security))

Tier logic and throttling (Starter / Trial / Plus / Pro)

Security, quotas, and admin tooling

It is the web-app rewrite of the “Plan / Life Plan” blueprint, adapted for the current FE web app navigation.

PLAN FINAL

0. Role of the Plan Tab in the Web App

The Plan tab is:

The home of the Life Plan (20-question questionnaire + AI-driven plan).

A single, scrollable screen that:

Lets users view / edit their Life Plan.

Shows progress & stability visually.

Highlights strengths & skills.

Provides a focused FE Coach AI card to interpret their situation and suggest next actions.

PLAN FINAL

The Plan tab must:

Motivate action every time they open it.

Avoid complexity and sub-navigation.

Be tier-aware (Starter, Trial, Plus, Pro) in:

FE Coach AI usage (and AI credit usage for Starter).

Life Plan regeneration usage limits (tier-based).

Access to weekly motivational video content (kept as a Plan-specific benefit).

Relationship to other app areas:

Onboarding: collects first Life Plan answers via /onboarding/questions. The Plan tab is the permanent “home” for reading and updating that Life Plan.

Jobs: uses Life Plan and strengths for job matching and tags (“Matches your Life Plan”).

FE Button: offers skills, courses, and content that align with Plan recommendations.

Profile/Settings: stores tier, trial status, and subscription/billing access.

1. Routes, Navigation, and Access
1.1 Routes (App Router)

/plan — main Plan tab screen (the layout described below).

/plan/life-plan — full “Open Life Plan” view/edit page (if we separate it from /plan for clarity).

/api/plan/* — Plan-specific backend endpoints (see Section 9).

These routes belong to the authenticated app group: app/(app)/plan.

1.2 Navigation

Mobile (primary):

Global bottom navigation bar:

Left: Home (Dashboard) → /dashboard

Left-center: Plan (active) → /plan

Center: Glowing FE Button → opens FE menu

Right-center: Jobs → /jobs

Right: Profile → /profile

Tapping Plan always lands on /plan.

Desktop / tablet:

Top navigation bar: Home, Plan, FE, Jobs, Profile (plus logo).

When Plan is active, /plan content occupies main body, using a two-column layout at larger breakpoints (for example: AI card and progress blocks side-by-side).

1.3 Access Control

Only authenticated, onboarded users can access /plan.

Middleware / OnboardingGate:

If no Supabase session ⇒ redirect to /login.

If onboarding is not complete (user has not submitted the Life Plan Questionnaire) ⇒ redirect to the appropriate /onboarding/... step.

Tier logic:

All tiers (Starter, Trial, Plus, Pro) can access /plan.

Specific actions and interactive elements (FE Coach input, regeneration, videos) are gated by tier rules defined in Tiers & Access.

Important alignment note:

We do not use plan_tier or trial_tier fields in profiles.

Tier is determined by profiles.tier and profiles.subscription_status, plus trial timestamps trial_started_at / trial_ends_at (per the canonical tier blueprint).

2. Layout and UI for /plan (Mobile-First)

The content order (top → bottom) on mobile is:

Global FE header

“Your Life Plan” hero intro + privacy line

Life Plan access card (“View Your Life Plan”)

AI Life Plan Summary + FE Coach card

Phase badge + progress rings section

Strengths & Skills badges

Motivational video (Trial/Plus/Pro only; locked teaser for Starter)

PLAN FINAL

No internal subtabs, no micro-nav.

2.1 Global Header

Shared with other tabs:

Left: FE bubble logo

Center: “Felon Entrepreneur” wordmark

Right: Hamburger → Settings (account, subscriptions, legal, etc.)

2.2 Hero Intro: “Your Life Plan”

Component: <PlanHeroIntro />

Title: “Your Life Plan”

Subline (short, strong copy):

“This is your private blueprint. We use your answers, real experience, and AI to help you move from where you are to where you want to be.”

Privacy reassurance (small text):

“Your Life Plan is 100% private. Only you can see it.”

PLAN FINAL

2.3 Life Plan Access Card

Component: <LifePlanAccessCard />

Card includes:

Title: “View Your Life Plan”

Short description:
“Review or update the answers that shape your recommendations.”

Primary button:
“Open Life Plan” → navigates to /plan/life-plan (full view/edit screen) or opens a full-screen overlay.

3. Life Plan View / Edit Experience

The Life Plan itself is a full-screen page that consolidates all 20 questions and answers into a clear, scrollable layout.

Route: /plan/life-plan

3.1 Read-Only Mode (Default)

Component: <LifePlanView />

Shows all four sections of the Life Plan in order:

Where You’re Starting (Q1–Q5)

Family & Responsibilities (Q6–Q10)

Work & Skills (Q11–Q15)

Direction & Support (Q16–Q20)

All fields are read-only.

At top of page:

“Last updated: [DATE]”

This reflects life_plans.updated_at (or a dedicated last_edited_at if maintained).

Buttons displayed at top and bottom of the view:

Edit (enabled)

Cancel (disabled)

Save & Finish Later (disabled)

Regenerate Plan (disabled until editing begins)

Important alignment note:

We do not use “Update frequency” as a separate concept anymore.

The tier-limited action that refreshes AI output is named Regenerate Plan and is governed by the Life Plan Regeneration limits from the tier blueprint.

3.2 Edit Mode (In-Place Editing)

When user taps Edit:

All fields become editable (inputs and textareas).

Banner at top:
“Editing your Life Plan — changes are not saved yet.”

Buttons at top and bottom now behave as follows:

Edit: disabled (already in edit mode)

Cancel: enabled — discards unsaved changes and returns to read-only state

Save & Finish Later: disabled until any change is detected

Regenerate Plan: disabled until any change is detected

When the user changes any answer:

Enable both “Save & Finish Later” and “Regenerate Plan”.

3.2.1 Save & Finish Later (Draft Save)

Behavior:

Saves all changes to Life Plan answers as a draft.

Does not regenerate AI summary.

Does not consume:

Life Plan regeneration entitlements

AI credits

Any tier usage bucket

Writes to:

life_plans.data (updated answers)

life_plans.last_edited_at (optional; otherwise updated_at is sufficient)

Returns user to read-only view.

Use case:

User wants to clean up or update answers without consuming a regeneration.

3.2.2 Regenerate Plan (Tier-Limited AI Refresh)

Pressing Regenerate Plan:

Opens confirmation modal:

“Are you sure? Regenerating your Life Plan will refresh your recommendations and coaching guidance.”

Modal buttons:

Cancel → back to editing (no save)

Regenerate Life Plan → triggers tier-aware regeneration flow

If they confirm:

Backend validates:

User authenticated

Onboarding complete

Tier permits a regeneration right now, OR user has a valid single-use regeneration purchase

If over limit and no single-use purchase:

Return error; frontend shows modal:

“To keep your Life Plan stable and accurate, you can regenerate again on [DATE].
Need more flexibility? Upgrade to Plus or Pro, or purchase a single regeneration.”

If within limit (or single-use purchase is available):

Save answers to life_plans.data

Trigger AI regeneration of:

Life Plan summary card content

Strength tags

Phase label

Support & stability score

Update:

life_plans.ai_summary

life_plans.strength_tags

life_plans.phase_label

life_plans.support_stability_score

life_plans.last_ai_refresh_at

Record usage events (see database section)

Return success toast:
“Life Plan regenerated. Your recommendations have been refreshed.”

3.3 Tier-Based Life Plan Regeneration Limits (Aligned to Tier Canon)

Life Plan regeneration is governed by the canonical tier blueprint:

Starter: 0 included regenerations

Trial: 1 included regeneration (during the 7-day Pro-Lite Trial window)

Plus: 4 regenerations per month

Pro: 8 regenerations per month

Any tier: single-use regeneration purchase available at $2.99 per use

Important:

Starter users can edit and save drafts unlimited times.

Starter users can regenerate only by:

Upgrading, OR

Purchasing a $2.99 single-use regeneration

Implementation note:

Regeneration usage is tracked in usage_periods.lifeplan_regens_count with monthly periods.

Single-use purchases must be tracked and enforced server-side (never client-trusted).

4. AI Life Plan Summary + FE Coach Card

This is the central intelligence block on /plan.

Component: <LifePlanSummaryCard />

4.1 Purpose

Convert 20 Life Plan answers + ZIP code into:

A clear reading of current situation

Short, concrete recommendations

Local-aware guidance by ZIP code

Serve as the primary place where the user interacts with AI about their life.

4.2 Card Layout

Title: “Your Life Plan Overview”

Description:

“Here’s how your situation looks right now — and where we think you can move next.”

Then multi-section content, each section representing a Life Plan group:

Where You’re Starting
1–2 lines summarizing: phase + main concern
2–3 bullet recommendations about immediate next steps

Family & Responsibilities
1–2 lines summarizing responsibilities
2–3 bullet recommendations aligned with stability and support

Work, Money & Direction
1–2 lines summarizing urgency and current work situation
2–3 bullets: near-term earning moves, recommended roles, how to use Jobs tab

Skills & Growth
1–2 lines mapping skills + desired learning
2–3 bullets recommending which skills to focus on and where to start

Support & Environment
1–2 lines summarizing support network and environment stability
2–3 bullets recommending weekly actions and resources

All content is:

short

plain-language

action-oriented

4.3 FE Coach Prompt Bar (Bottom of Card)

Component: <FeCoachPromptBar context="plan" />

Input placeholder:

“Ask FE Coach about your Life Plan…”

Send button triggers the AI chat endpoint.

Important alignment changes:

FE Coach is governed by the Universal AI credits model for Starter and by soft caps/throttles for Trial/Plus/Pro.

We do not use “trial tier = plus/pro” logic. Trial is a single tier state: tier = trial.

4.3.1 Starter (AI Credits Model)

Starter users can chat with FE Coach on the Plan tab as long as they have credits.

Starter AI rules (canonical):

Starter receives 10 universal AI credits

Credits refresh every 7 days

Every AI submission anywhere consumes 1 credit

Plan FE Coach behavior (Starter):

If starter_ai_credits_remaining > 0:

Input is enabled

Each send consumes 1 credit

UI shows “Credits remaining: X” (Plan-specific display is fine, but it’s universal credits)

If starter_ai_credits_remaining = 0:

Input is disabled

Display:
“You’re out of AI credits. Your credits refresh on [DATE].
Need more? Start a 7-day trial or upgrade.”

No separate “free credits TBD” concept exists anymore. The Starter credit model is exact and consistent across the app.

4.3.2 Trial (7-Day Pro-Lite Trial)

Trial FE Coach behavior:

FE Coach is enabled

Do not show a Starter credit counter (trial is not credits-based)

Apply throttling:

per-minute rate limits

daily ceilings

trial-period soft caps (anti-abuse)

Trial ends behavior (canonical):

If user cancels before the 7 days are up: revert to Starter

If user does not cancel: converts to Plus

4.3.3 Plus

Plus FE Coach behavior:

Enabled

No visible credit counter

Soft cap enforcement (example):

approximately 500 AI submissions per month across the app

Throttling applied to prevent abuse

If near soft cap, show warnings in UI.

If exceeded, endpoint returns limit error and UI shows:

“You’ve hit your AI limit for this period. It resets on [DATE]. Upgrade to Pro for more.”

4.3.4 Pro

Pro FE Coach behavior:

Enabled

No visible credit counter

Higher soft cap (example):

approximately 1000 AI submissions per month across the app

Throttling applied to prevent abuse

5. Phase Badge + Progress Rings Section

Component: <PlanProgressSection />

Placed below AI card.

PLAN FINAL

5.1 “Your Progress & Stability”

Section title: “Your Progress & Stability”.

5.2 Phase Badge

Single pill label:

“Current Phase: [phrase, e.g., Rebuilding Step-by-Step]”

Derived from Life Plan answers + AI summary.

Tap → modal explaining:

what this phase means

what the primary goal is in this phase

what to focus on this week

5.3 Life Plan Completion Ring

Ring 1: “Life Plan Completion”

Value: percent of 20 Life Plan questions answered.

Subtitle:

“Your Life Plan is [X]% complete.”

Text under ring:

“Open your Life Plan to review or update your answers.”

No fake “tasks completed” metrics.

5.4 Support & Stability Ring

Ring 2: “Support & Stability”

Score: simple 0–100 index derived from:

housing stability

dependents situation

support network strength

environment stability indicators

Label: “Support & Stability”.

Text:

“Your stability score is in the [Fragile / Building / Stronger] range.”

Tap behavior:

Scroll to Support & Environment section in the AI summary, OR

Open modal with 2–3 recommended actions pulled from cached AI summary

6. Strengths & Skills Section

Component: <StrengthsSkillsSection />

Title: “What You Bring to the Table”

Shows chips/badges for strengths inferred from answers:

Example badges:

Responsible Parent, Hustler Mindset, Hands-On Worker, Strong Communicator, Fast Learner, Leadership Potential.

Tap a badge → modal:

Definition: one line about what this strength means

Suggestion: one line about how to use it in jobs/courses/support

At bottom:

“We use these to match you with jobs, courses, and support that fit who you are.”

No separate AI prompts inside each badge; if user wants more, they use FE Coach input.

7. Motivational Video (Trial/Plus/Pro; Locked for Starter)

Component: <PlanMotivationalVideo />

Title: “This Week’s Message”

For Trial/Plus/Pro:

Shows video card with thumbnail, play button, short description

Uses shared video player component:

play/pause

10s rewind

progress bar

captions

fullscreen

optional reactions

For Starter:

Show dimmed card with overlay:
“Weekly coaching videos are available on Trial, Plus, and Pro. Start a 7-day trial to unlock this section.”

No AI inside this component; content is static video from DB or CMS.

8. Package / Tier Behavior Summary (Plan Tab)

This section clarifies exactly what Plan does by tier.

8.1 Starter

Can:

Access /plan

View hero intro, Life Plan card, and read-only Life Plan

Edit answers and “Save & Finish Later” unlimited times

Use FE Coach while credits remain (10 credits per 7 days)

View existing AI summary content (cached)

Cannot (unless purchasing single-use or upgrading):

Regenerate Life Plan (0 included)

Access weekly video content (locked teaser only)

8.2 Trial (7-Day Pro-Lite Trial)

Can:

Everything Starter can

FE Coach enabled (throttled)

Regenerate Life Plan: 1 included

Access weekly videos

Cannot:

Resume Builder access is not relevant on Plan, but it remains locked at the tier level

Trial ends behavior:

Cancel before end: revert to Starter

Not canceled: convert to Plus

8.3 Plus

Can:

Everything Starter can

FE Coach enabled (soft caps/throttles)

Regenerate Life Plan: 4 per month

Access weekly videos

8.4 Pro

Can:

Everything Plus can

FE Coach enabled with higher ceilings

Regenerate Life Plan: 8 per month

Access weekly videos

9. Data Model (Supabase)

This blueprint assumes canonical tier fields and usage tracking exist per the Tier blueprint.

9.1 profiles (canonical tier fields used here)

Must include at minimum:

id (uuid, PK, FK → auth.users.id)

preferred_name (text)

zip_code (text)

onboarding_step (text/enum)

tier (enum: starter, trial, plus, pro)

subscription_status (enum-like string)

trial_started_at (timestamp, nullable)

trial_ends_at (timestamp, nullable)

starter_ai_credits_remaining (int)

starter_ai_reset_at (timestamp)

timestamps

RLS: user can only select/update their own row, with strict denial for money-sensitive fields (tier/status/credits) from client writes.

Important change:

Remove references to profiles.plan_tier and profiles.trial_tier. Plan reads from tier and trial timestamps only.

9.2 life_plans

Represents the current Life Plan for each user.

Must include:

id (uuid, PK)

user_id (uuid, FK → profiles.id)

data (jsonb) — structured answers to Q1–Q20

phase_label (text)

completion_percentage (int 0–100)

support_stability_score (int 0–100)

strength_tags (text[])

ai_summary (jsonb) — cached card content

last_ai_refresh_at (timestamp)

last_edited_at (timestamp)

timestamps

RLS: user may select/update where user_id = auth.uid().

9.3 questionnaire_answers (optional but recommended)

Stores raw per-question answers:

id (uuid, PK)

user_id (uuid, FK)

answers_json (jsonb) or per-question rows

timestamps

Used for:

analytics

reprocessing

plan versioning

9.4 usage_periods (canonical monthly period counters)

Tracks monthly usage per user (period_start / period_end):

lifeplan_regens_count

ai_messages_count

other counters for other tools (not Plan-specific)

Plan uses this for:

Life Plan regenerations (Plus/Pro monthly counters)

Soft AI caps for Plus/Pro

9.5 usage_events (canonical append-only audit trail)

Append-only audit:

event_type (ai_chat, lifeplan_regen, etc.)

metadata (jsonb; include context: “plan”, endpoint, tier snapshot)

created_at

Plan uses this for:

forensic audit

abuse detection

debugging counters vs reality

9.6 plan_fe_coach_sessions (optional)

If storing chat history:

id

user_id

prompt

response

context = 'plan'

timestamps

RLS: user can read their own sessions.

9.7 plan_videos

If storing weekly motivational videos:

id

title

description

video_url

thumbnail_url

week_of

active

timestamps

10. Backend APIs (Next.js Route Handlers)
10.1 Fetch Plan Data

GET /api/plan

Auth required.

Returns:

lifePlan (from life_plans)

aiSummary

progress values

strengthTags

tierInfo (tier, subscription_status, trial window, next reset dates for Starter credits)

10.2 Life Plan Draft Save

POST /api/plan/save-draft

Body: updated Life Plan answers.

Auth required.

Writes:

life_plans.data

life_plans.last_edited_at

Does not:

regenerate AI

consume regeneration entitlements

consume AI credits

10.3 Life Plan Regeneration (AI Refresh)

POST /api/plan/regenerate

Body: updated Life Plan answers.

Server steps:

Auth check

Ensure onboarding complete

Load tier and enforce regeneration access:

Trial: allow 1 total during trial

Plus: allow up to 4/month

Pro: allow up to 8/month

Starter: only allow if single-use purchase exists

If allowed:

Save answers

Call AI

Write derived fields and ai_summary

Increment usage_periods.lifeplan_regens_count (or decrement a single-use entitlement)

Append usage_events record

Return:

updated plan summary and fields

10.4 FE Coach (Plan Tab AI Chat)

POST /api/ai/chat (recommended canonical endpoint)
Body includes: context = “plan”, message, optional conversation id

Server steps:

Auth check

Resolve tier and enforce:

Starter: enforce weekly credits (decrement 1 per submission; apply refresh logic)

Trial: allow, throttled

Plus/Pro: allow with soft caps and throttling

Append usage_events record for every AI submission

If storing chat: add plan_fe_coach_sessions row

Return AI response

10.5 Plan Video

GET /api/plan/video

Return:

video metadata if tier in (trial, plus, pro)

locked response if tier is starter

11. Security and RLS (Row-Level Security)

All per-user tables must have RLS enabled.

Clients must never be allowed to write:

tier

subscription_status

trial timestamps

Starter credits counters

usage_periods counters

any “remaining uses” or “allowed actions” fields

AI endpoints must always:

validate session

resolve tier server-side

enforce quotas server-side

never trust frontend flags

only use the user’s own data for prompts

Life Plan and AI summary data are private to the user:

no public reads

no cross-user access

no exposure during onboarding or public routes

12. Emails and Notifications (Plan-Relevant)

This Plan page should trigger or integrate with these notifications (as defined in the onboarding/tier lifecycle):

Starter credit-related:

“Credits low” (optional)

“Credits refreshed” (optional; in-app notification is acceptable)

Trial-related:

Trial started (email + in-app)

Trial reminder (email + in-app)

Trial ending soon (email + in-app)

Tier conversion outcomes:

Trial converted to Plus

Trial canceled → reverted to Starter

Subscription payment issues (if a user is Plus/Pro)

Plan action confirmations:

Life Plan regenerated successfully (in-app toast)

Regeneration blocked due to limits (modal + upgrade CTA)

Regeneration blocked but single-use purchase option available (modal + purchase CTA)

13. Admin / Internal Controls (High-Level)

For later or separate admin app:

Manage weekly motivational videos (plan_videos)

Review aggregate, anonymized Plan usage metrics

Abuse monitoring via usage_events and throttling logs

Admin access should be implemented via an admin role model and RLS policies that never expose user private content unnecessarily.